source_dir: .git/hooks

pre-commit:
  parallel: true
  commands:
    lint:
      run: npm run lint
      stage_fixed: true
    format:
      run: npx prettier --check .
      stage_fixed: true

commit-msg:
  commands:
    commitlint:
      run: npx commitlint --edit {1}

pre-push:
  parallel: false # Sequencial para garantir ordem correta
  commands:
    validate-basics:
      run: |
        echo "üîç Valida√ß√£o b√°sica..."
        npm run validate
    test-with-snapshots:
      run: |
        echo "üß™ Testando com poss√≠vel atualiza√ß√£o de snapshots..."
        npm test 2>/dev/null || {
          echo "üì∏ Atualizando snapshots..."
          npm run test:snapshots
          git add "**/__snapshots__/**" || true
        }
    sonar-doublecheck:
      run: |
        echo "üîç SonarQube Double-Check..."

        # Obter arquivos modificados que ainda n√£o foram commitados
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

        # Obter arquivos modificados em rela√ß√£o ao commit anterior
        MODIFIED_FILES=$(git diff HEAD~1 --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

        ALL_FILES="$STAGED_FILES $MODIFIED_FILES"

        if [ -z "$ALL_FILES" ]; then
          echo "‚ÑπÔ∏è  Nenhum arquivo TS/JS modificado encontrado"
          echo "‚úÖ Prosseguindo sem an√°lise SonarQube"
        else
          echo "üìä Executando npm run sonar:doublecheck..."
          npm run sonar:doublecheck
          
          echo "üìà Relat√≥rio: https://sonarcloud.io/project/overview?id=mayconaraujosantos_pillmind"
          echo "üí° Verifique o Problems Panel (Ctrl+Shift+M) no VS Code para issues detalhadas"
          echo "‚úÖ SonarQube double-check conclu√≠do!"
        fi
