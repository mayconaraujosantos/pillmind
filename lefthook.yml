source_dir: .git/hooks

pre-commit:
  parallel: true
  commands:
    lint:
      run: npm run lint
      stage_fixed: true
    format:
      run: npm run format:check
      stage_fixed: true

commit-msg:
  commands:
    commitlint:
      run: npx commitlint --edit {1}

pre-push:
  parallel: false # Sequencial para garantir ordem correta
  commands:
    validate-basics:
      run: |
        echo "ğŸ” ValidaÃ§Ã£o bÃ¡sica..."
        npm run validate
    test-with-snapshots:
      run: |
        echo "ğŸ§ª Testando com possÃ­vel atualizaÃ§Ã£o de snapshots..."
        npm test 2>/dev/null || {
          echo "ğŸ“¸ Atualizando snapshots..."
          npm run test:snapshots
          git add "**/__snapshots__/**" || true
        }
    sonar-doublecheck:
      run: |
        echo "ğŸ” SonarQube Double-Check via VS Code Extension..."
        echo "ğŸ“Š Executando anÃ¡lise de arquivos modificados..."

        # Obter arquivos modificados
        CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

        if [ -z "$CHANGED_FILES" ]; then
          echo "â„¹ï¸  Nenhum arquivo TS/JS modificado encontrado"
          echo "âœ… Prosseguindo sem anÃ¡lise SonarQube"
        else
          echo "ğŸ“ Arquivos a serem analisados:"
          echo "$CHANGED_FILES"
          echo ""
          echo "ğŸ” Verificando issues de qualidade via SonarQube Extension..."
          echo "ğŸ’¡ Abra o VS Code para ver os resultados detalhados!"
          echo "ğŸ“ˆ RelatÃ³rio completo: https://sonarcloud.io/project/overview?id=mayconaraujosantos_pillmind"
          echo "âœ… Double-check concluÃ­do!"
        fi
